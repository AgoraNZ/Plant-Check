<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Farm Details
        doc.setFontSize(12);
        doc.text("Farm Details", 10, 10);
        doc.text(`Dairy Company: ${document.querySelector('input[name="dairy_company"]').value}`, 10, 20);
        doc.text(`Dairy Number: ${document.querySelector('input[name="dairy_number"]').value}`, 10, 30);
        doc.text(`Address: ${document.querySelector('input[name="address"]').value}`, 10, 40);
        doc.text(`Customer Name: ${document.querySelector('input[name="customer_name"]').value}`, 10, 50);
        doc.text(`Region: ${document.querySelector('select[name="region"]').value}`, 10, 60);
        doc.text(`Farm Name: ${document.querySelector('input[name="farm_name"]').value}`, 10, 70);
        doc.text(`Island: ${document.querySelector('select[name="island"]').value}`, 10, 80);
        doc.text(`Visit Date: ${document.querySelector('input[name="visit_date"]').value}`, 10, 90);
        doc.text(`Visit Type: ${document.querySelector('input[name="visit_type"]').value}`, 10, 100);
        doc.text(`Time Inspection Started: ${document.querySelector('input[name="inspection_start"]').value}`, 10, 110);
        doc.text(`Time Inspection Ended: ${document.querySelector('input[name="inspection_end"]').value}`, 10, 120);
        doc.text(`Inspection Completed by: ${document.querySelector('input[name="completed_by"]').value}`, 10, 130);
        doc.text(`Call Type: ${document.querySelector('select[name="call_type"]').value}`, 10, 140);
        doc.text(`General Visit Notes: ${document.querySelector('textarea[name="visit_notes"]').value}`, 10, 150);
        
        // Health & Safety Section
        doc.addPage();
        doc.text("Health & Safety", 10, 10);
        const healthSafetyStatus = document.querySelector('select[name="health_safety_status"]').value;
        const healthSafetyComments = document.querySelector('input[name="health_safety_comments"]').value;
        doc.text(`Health & Safety Status: ${healthSafetyStatus}`, 10, 20);
        doc.text(`Comments: ${healthSafetyComments}`, 10, 30);

        // Milking Plant Section
        doc.addPage();
        doc.text("Milking Plant", 10, 10);
        const components = [
            'Pulsator Airline',
            'Long Bend Elbows',
            'Automatic Cup',
            'Remover',
            'Diaphram',
            'Receiving Can',
            'Sanitary Trap',
            'Main Milk Line',
            'Milk Line Seals in good condition',
            'Stainless Droppers',
            'Long Milk Rubber'
        ];

        components.forEach((component, index) => {
            const status = document.querySelector(`select[name="${component.toLowerCase().replace(/ /g, "_")}_status"]`).value;
            const comments = document.querySelector(`input[name="${component.toLowerCase().replace(/ /g, "_")}_comments"]`).value;
            doc.text(`${component} Status: ${status}`, 10, 20 + (index * 10));
            doc.text(`Comments: ${comments}`, 10, 25 + (index * 10));
        });

        // Milk Vat Section (same structure as Milking Plant)
        const milkVatComponents = [
            'Liner',
            'Cluster',
            'Cluster Seal',
            'Cluster Button',
            'Non Return Valve at Milk Pump',
            'Milk Pump',
            'Filter Housing',
            'Plate Cooler',
            'Interceptor',
            'Receiver Airline',
            'Flushing Pulsator',
            'Air Purge Valve',
            'Vacuum Level',
            'Main Airline',
            'Plant Drainage - Milk Pump',
            'Plant Drainage - Filter/s',
            'Plant Drainage - Plate Cooler',
            'Plant Drainage - Vat Entry',
            'Plant Wash Tap',
            'Wash Jetters',
            'Centre Gland',
            'Test Bucket',
            'Inlet Valve',
            'Non-Return Valve',
            'Spray Ball',
            'Agitator',
            'Silo door',
            'Manhole Seal',
            'Vat Outlet',
            'Walls in silo'
        ];

        milkVatComponents.forEach((component, index) => {
            const status = document.querySelector(`select[name="${component.toLowerCase().replace(/ /g, "_")}_status"]`).value;
            const comments = document.querySelector(`input[name="${component.toLowerCase().replace(/ /g, "_")}_comments"]`).value;
            doc.text(`${component} Status: ${status}`, 10, 20 + (index * 10));
            doc.text(`Comments: ${comments}`, 10, 25 + (index * 10));
        });

        // Signature Details
        doc.addPage();
        doc.text("Signature Details", 10, 10);
        doc.text(`Role: ${document.querySelector('input[name="role"]').value}`, 10, 20);
        doc.text(`User: ${document.querySelector('input[name="user"]').value}`, 10, 30);
        doc.text(`Signed At: ${document.querySelector('input[name="signed_at"]').value}`, 10, 40);
        doc.text(`Comment: ${document.querySelector('textarea[name="comment"]').value}`, 10, 50);

        // Problems Summary (dummy example; modify with your logic)
        const problems = [];
        if (healthSafetyStatus === 'attention_required') {
            problems.push("Health & Safety requires attention.");
        }
        components.forEach(component => {
            const status = document.querySelector(`select[name="${component.toLowerCase().replace(/ /g, "_")}_status"]`).value;
            if (status === 'attention_required') {
                problems.push(`${component} requires attention.`);
            }
        });

        if (problems.length > 0) {
            doc.addPage();
            doc.text("Problems Summary & Recommendations", 10, 10);
            problems.forEach((problem, index) => {
                doc.text(`${index + 1}. ${problem}`, 10, 20 + (index * 10));
            });
        } else {
            doc.addPage();
            doc.text("No issues reported.", 10, 10);
        }

        // Save the PDF
        doc.save('Dairy_Shed_Hygiene_Checklist.pdf');
    }
</script>
