<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dairy Shed Hygiene Checklist</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <style>
        body {
            background-color: #001F3F;
            color: #FFFFFF;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            margin: 0;
        }
        .container {
            background-color: #002B5C;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            width: 100%;
        }
        h1, h2 {
            color: #FF851B;
            text-align: center;
        }
        label {
            margin-top: 10px;
        }
        button {
            background-color: #FF851B;
            color: #FFFFFF;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            border-radius: 5px;
        }
        button:hover {
            background-color: #FF4136;
        }
        .checklist-item {
            margin-bottom: 15px;
        }
        .form-control, .form-select {
            margin-top: 5px;
        }
        .version {
            text-align: center;
            margin-top: 20px;
            color: #FFFFFF;
            font-size: 12px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Dairy Shed Hygiene Checklist</h1>
        
        <form id="hygiene-checklist-form">
            <div class="section mb-4">
                <h2>Farm Details</h2>
                <label for="dairy-company">Dairy Company:</label>
                <input type="text" class="form-control" id="dairy-company" name="dairy-company">

                <label for="dairy-number">Dairy Number:</label>
                <input type="text" class="form-control" id="dairy-number" name="dairy-number">

                <label for="address">Address:</label>
                <input type="text" class="form-control" id="address" name="address">

                <label for="customer-name">Customer Name:</label>
                <input type="text" class="form-control" id="customer-name" name="customer-name">

                <label for="region">Region:</label>
                <select id="region" name="region" class="form-select">
                    <option value="northland">Northland</option>
                    <option value="auckland">Auckland</option>
                    <option value="waikato">Waikato</option>
                    <option value="bay-of-plenty">Bay of Plenty</option>
                    <option value="gisborne">Gisborne</option>
                    <option value="hawkes-bay">Hawke's Bay</option>
                    <option value="taranaki">Taranaki</option>
                    <option value="manawatu-wanganui">Manawatu-Wanganui</option>
                    <option value="wellington">Wellington</option>
                    <option value="other">Other</option>
                </select>

                <label for="farm-name">Farm Name:</label>
                <input type="text" class="form-control" id="farm-name" name="farm-name">

                <label for="island">Island:</label>
                <select id="island" name="island" class="form-select">
                    <option value="north-island">North Island</option>
                    <option value="south-island">South Island</option>
                </select>

                <label for="visit-date">Visit Date:</label>
                <input type="date" class="form-control" id="visit-date" name="visit-date">

                <label for="visit-type">Visit Type:</label>
                <input type="text" class="form-control" id="visit-type" name="visit-type">

                <label for="inspection-start-time">Inspection Start Time:</label>
                <input type="time" class="form-control" id="inspection-start-time" name="inspection-start-time">

                <label for="inspection-end-time">Inspection End Time:</label>
                <input type="time" class="form-control" id="inspection-end-time" name="inspection-end-time">

                <label for="inspection-completed-by">Inspection Completed By:</label>
                <input type="text" class="form-control" id="inspection-completed-by" name="inspection-completed-by">

                <label for="call-type">Call Type:</label>
                <input type="text" class="form-control" id="call-type" name="call-type">
            </div>

            <div class="section mb-4">
                <h2>Checklist Items</h2>
                <div id="checklist-items">
                    <!-- Checklist items will be dynamically added here -->
                </div>
            </div>

            <button type="button" onclick="generatePDF()">Generate PDF</button>
        </form>
        <div class="version">Version 2.7</div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        const checklistItems = [
            "Pulsator Airline", "Long Bend Elbows", "Automatic Cup and Remover", "Diaphragm", "Receiving Can",
            "Sanitary Trap", "Main Milk Line", "Milk Line Seals in Good Condition", "Stainless Droppers", "Long Milk Rubber",
            "Liner", "Cluster", "Cluster Seal", "Cluster Button", "Non Return Valve at Milk Pump", "Milk Pump",
            "Filter Housing", "Plate Cooler", "Interceptor", "Receiver Airline", "Flushing Pulsator", "Air Purge Valve",
            "Vacuum Level", "Main Airline", "Plant Drainage - Milk Pump", "Plant Drainage - Filter/s", "Plant Drainage - Plate Cooler",
            "Plant Drainage - Vat Entry", "Plant Wash Tap", "Wash Jetters", "Centre Gland", "Test Bucket", "Inlet Valve",
            "Non-Return Valve", "Spray Ball", "Agitator", "Silo Door", "Manhole Seal", "Vat Outlet", "Walls in Silo"
        ];

        let customerData = {}; // To store customer details for auto-population

        document.addEventListener("DOMContentLoaded", () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('visit-date').value = today;

            const checklistContainer = document.getElementById('checklist-items');
            checklistContainer.innerHTML = ''; // Ensure the container is empty before adding items
            checklistItems.forEach(item => {
                const itemContainer = document.createElement('div');
                itemContainer.classList.add('checklist-item');

                const label = document.createElement('label');
                label.textContent = item;
                itemContainer.appendChild(label);

                const statusSelect = document.createElement('select');
                statusSelect.classList.add('form-select');
                statusSelect.innerHTML = `
                    <option value="ok">OK</option>
                    <option value="attention-required">Attention Required</option>
                    <option value="na">N/A</option>
                `;
                itemContainer.appendChild(statusSelect);

                const commentsInput = document.createElement('input');
                commentsInput.type = 'text';
                commentsInput.classList.add('form-control');
                commentsInput.placeholder = 'Comments';
                itemContainer.appendChild(commentsInput);

                const imageUpload = document.createElement('input');
                imageUpload.type = 'file';
                imageUpload.classList.add('form-control', 'image-upload');
                imageUpload.style.display = 'none';
                itemContainer.appendChild(imageUpload);

                statusSelect.addEventListener('change', () => {
                    if (statusSelect.value === 'attention-required') {
                        imageUpload.style.display = 'block';
                    } else {
                        imageUpload.style.display = 'none';
                    }
                });

                checklistContainer.appendChild(itemContainer);
            });

            // Auto-fill customer details based on dairy number
            document.getElementById('dairy-number').addEventListener('input', function() {
                const dairyNumber = this.value;
                if (customerData[dairyNumber]) {
                    const customer = customerData[dairyNumber];
                    document.getElementById('dairy-company').value = customer.dairyCompany;
                    document.getElementById('address').value = customer.address;
                    document.getElementById('customer-name').value = customer.customerName;
                    document.getElementById('region').value = customer.region;
                    document.getElementById('farm-name').value = customer.farmName;
                    document.getElementById('island').value = customer.island;
                }
            });
        });

        async function generatePDF() {
            const form = document.getElementById('hygiene-checklist-form');
            let formData = new FormData(form);
            const dairyNumber = formData.get('dairy-number');

            // Save customer data for future auto-population
            customerData[dairyNumber] = {
                dairyCompany: formData.get('dairy-company'),
                address: formData.get('address'),
                customerName: formData.get('customer-name'),
                region: formData.get('region'),
                farmName: formData.get('farm-name'),
                island:
