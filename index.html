from fpdf import FPDF
from datetime import datetime

# Checklist items data
checklist_items = {
    "Health & Safety": [
        {"name": "Safety Signage", "status": "ok", "comments": "All signs are visible.", "photo_path": None},
        {"name": "Emergency Exits", "status": "attention required", "comments": "One exit is blocked.", "photo_path": None},
        # Add more items as needed...
    ],
    "Milking Plant": [
        {"name": "Pulsator Airline", "status": "ok", "comments": "In good condition.", "photo_path": None},
        {"name": "Long Bend Elbows", "status": "ok", "comments": "No leaks.", "photo_path": None},
        {"name": "Automatic Cup Remover", "status": "ok", "comments": "Functional.", "photo_path": None},
        {"name": "Diaphragm", "status": "attention required", "comments": "Needs replacement.", "photo_path": None},
        {"name": "Receiving Can", "status": "ok", "comments": "Clean.", "photo_path": None},
        {"name": "Sanitary Trap", "status": "ok", "comments": "No issues.", "photo_path": None},
        {"name": "Main Milk Line", "status": "ok", "comments": "In good condition.", "photo_path": None},
        {"name": "Milk Line Seals", "status": "ok", "comments": "Seals intact.", "photo_path": None},
        {"name": "Stainless Droppers", "status": "ok", "comments": "In good condition.", "photo_path": None},
        {"name": "Long Milk Rubber", "status": "ok", "comments": "No damage.", "photo_path": None},
        {"name": "Liner", "status": "attention required", "comments": "Signs of wear.", "photo_path": None},
        {"name": "Cluster", "status": "ok", "comments": "Clean.", "photo_path": None},
        {"name": "Cluster Seal", "status": "ok", "comments": "No leaks.", "photo_path": None},
        {"name": "Cluster Button", "status": "ok", "comments": "Functional.", "photo_path": None},
        {"name": "Non Return Valve at Milk Pump", "status": "ok", "comments": "In good condition.", "photo_path": None},
        {"name": "Milk Pump", "status": "ok", "comments": "Operational.", "photo_path": None},
        {"name": "Filter Housing", "status": "ok", "comments": "No leaks.", "photo_path": None},
        {"name": "Plate Cooler", "status": "ok", "comments": "Clean.", "photo_path": None},
        {"name": "Interceptor", "status": "ok", "comments": "No issues.", "photo_path": None},
        {"name": "Receiver Airline", "status": "ok", "comments": "No leaks.", "photo_path": None},
        {"name": "Flushing Pulsator", "status": "ok", "comments": "Operational.", "photo_path": None},
        {"name": "Air Purge Valve", "status": "ok", "comments": "Functional.", "photo_path": None},
        {"name": "Vacuum Level", "status": "ok", "comments": "Within range.", "photo_path": None},
        {"name": "Main Airline", "status": "ok", "comments": "No issues.", "photo_path": None},
        {"name": "Plant Drainage - Milk Pump", "status": "ok", "comments": "Clear.", "photo_path": None},
        {"name": "Plant Drainage - Filter/s", "status": "ok", "comments": "Clear.", "photo_path": None},
        {"name": "Plant Drainage - Plate Cooler", "status": "ok", "comments": "Clear.", "photo_path": None},
        {"name": "Plant Drainage - Vat Entry", "status": "ok", "comments": "Clear.", "photo_path": None},
        {"name": "Plant Wash Tap", "status": "ok", "comments": "Functional.", "photo_path": None},
        {"name": "Wash Jetters", "status": "ok", "comments": "Clean.", "photo_path": None},
        {"name": "Centre Gland", "status": "ok", "comments": "In good condition.", "photo_path": None},
        {"name": "Test Bucket", "status": "ok", "comments": "Clean.", "photo_path": None},
        {"name": "Inlet Valve", "status": "ok", "comments": "No leaks.", "photo_path": None},
        {"name": "Non-Return Valve", "status": "ok", "comments": "Functional.", "photo_path": None},
        {"name": "Spray Ball", "status": "ok", "comments": "Clean.", "photo_path": None},
        {"name": "Agitator", "status": "ok", "comments": "Operational.", "photo_path": None},
        {"name": "Silo Door", "status": "ok", "comments": "In good condition.", "photo_path": None},
        {"name": "Manhole Seal", "status": "ok", "comments": "Seals intact.", "photo_path": None},
        {"name": "Vat Outlet", "status": "ok", "comments": "Clear.", "photo_path": None},
        {"name": "Walls in Silo", "status": "ok", "comments": "Clean.", "photo_path": None},
    ],
    "Milk Vat": [
        {"name": "Temperature Monitoring", "status": "ok", "comments": "Within range.", "photo_path": None},
        {"name": "Milk Quality Check", "status": "ok", "comments": "Passed.", "photo_path": None},
    ],
    # Add more sections if needed...
}

# Summary and recommendations (example)
summary_text = """
Summary of Issues:
- Emergency Exit: One exit is blocked; please clear it immediately.
- Diaphragm: Needs replacement.
- Liner: Signs of wear; monitor closely.
"""

class PDF(FPDF):
    def header(self):
        self.set_font('Arial', 'B', 14)
        self.cell(0, 10, 'Dairy Shed Hygiene Checklist', 0, 1, 'C')
        self.cell(0, 10, f'Date: {datetime.now().strftime("%Y-%m-%d")}', 0, 1, 'C')
        self.ln(5)

    def chapter_title(self, title):
        self.set_font('Arial', 'B', 12)
        self.cell(0, 10, title, 0, 1, 'L')
        self.ln(2)

    def chapter_body(self, items):
        self.set_font('Arial', '', 11)
        for item in items:
            self.cell(60, 10, item['name'], 1)
            self.cell(30, 10, item['status'], 1)
            self.cell(80, 10, item['comments'], 1)

            # Include the image if it exists
            if item['photo_path']:
                try:
                    self.image(item['photo_path'], x=self.get_x() + 110, y=self.get_y() - 10, w=20)  # Adjust size and position as needed
                except Exception as e:
                    print(f"Error loading image: {e}")  # Handle image loading errors
            self.ln(10)

    def add_summary(self, summary):
        self.set_font('Arial', 'B', 12)
        self.cell(0, 10, 'Summary of Issues and Recommendations', 0, 1, 'L')
        self.set_font('Arial', '', 11)
        self.multi_cell(0, 10, summary)
        self.ln(5)

# Create PDF
pdf = PDF()
pdf.add_page()

# Add sections and items
for section_title, items in checklist_items.items():
    pdf.chapter_title(section_title)
    pdf.chapter_body(items)

# Add summary
pdf.add_summary(summary_text)

# Save the PDF
pdf_file_name = 'Dairy_Shed_Hygiene_Checklist.pdf'
pdf.output(pdf_file_name)

print(f'PDF generated successfully: {pdf_file_name}')
