<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dairy Shed Hygiene Checklist</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <style>
        body {
            background-color: #002B5C;
            color: #FFFFFF;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            margin: 0;
        }
        .container {
            background-color: #002B5C;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            width: 100%;
        }
        h1, h2 {
            color: #FF851B;
            text-align: center;
        }
        label {
            margin-top: 10px;
        }
        button {
            background-color: #FF851B;
            color: #FFFFFF;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            border-radius: 5px;
        }
        button:hover {
            background-color: #FF4136;
        }
        .checklist-item {
            margin-bottom: 30px;
        }
        .form-control, .form-select {
            margin-top: 5px;
        }
        .version {
            text-align: center;
            margin-top: 20px;
            color: #FFFFFF;
            font-size: 12px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <!-- Updated Firebase scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
</head>
<body>
    <div class="container">
        <h1>Dairy Shed Hygiene Checklist</h1>
        
        <form id="hygiene-checklist-form">
            <!-- Farm Details Section -->
            <div class="section mb-4">
                <h2>Farm Details</h2>
                <!-- Form fields here -->
                <label for="dairy-number">Dairy Number:</label>
                <input type="text" class="form-control" id="dairy-number" name="dairy-number">
            </div>

            <!-- Checklist Items Section -->
            <div class="section mb-4">
                <h2>Checklist Items</h2>
                <div id="checklist-items">
                    <!-- Checklist items will be dynamically added here -->
                </div>
            </div>

            <!-- Temperature Measurements Section -->
            <div class="section mb-4">
                <h2>Temperature Measurements</h2>
                <div class="checklist-item">
                    <label for="hot-water-temp">Hot Water Temp (°C):</label>
                    <input type="number" class="form-control" id="hot-water-temp" name="hot-water-temp" step="0.1">
                    <label for="hot-water-time">Time Taken:</label>
                    <input type="time" class="form-control" id="hot-water-time" name="hot-water-time">
                </div>
                <div class="checklist-item">
                    <label for="milk-temp">Milk Temp (°C):</label>
                    <input type="number" class="form-control" id="milk-temp" name="milk-temp" step="0.1">
                    <label for="milk-time">Time Taken:</label>
                    <input type="time" class="form-control" id="milk-time" name="milk-time">
                </div>
            </div>

            <button type="button" onclick="generatePDF()">Generate PDF</button>
        </form>
        <div class="version">Version 4.5</div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDr9nA44Kjejzeyg9E7nGUzbMDECI8cTFI",
            authDomain: "dairy-farm-record-system.firebaseapp.com",
            projectId: "dairy-farm-record-system",
            storageBucket: "dairy-farm-record-system.appspot.com",
            messagingSenderId: "422124188212",
            appId: "1:422124188212:web:1bd31bee8d6e91e301d061"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();

        const { jsPDF } = window.jspdf;
        const checklistItems = [
            "Pulsator Airline", "Long Bend Elbows", "Automatic Cup and Remover", "Diaphragm", "Receiving Can",
            "Sanitary Trap", "Main Milk Line", "Milk Line Seals in Good Condition", "Stainless Droppers", "Long Milk Rubber",
            "Liner", "Cluster", "Cluster Seal", "Cluster Button", "Non Return Valve at Milk Pump", "Milk Pump",
            "Filter Housing", "Plate Cooler", "Interceptor", "Receiver Airline", "Flushing Pulsator", "Air Purge Valve",
            "Vacuum Level", "Main Airline", "Plant Drainage - Milk Pump", "Plant Drainage - Filter/s", "Plant Drainage - Plate Cooler",
            "Plant Drainage - Vat Entry", "Plant Wash Tap", "Wash Jetters", "Centre Gland", "Test Bucket", "Inlet Valve",
            "Non-Return Valve", "Spray Ball", "Agitator", "Silo Door", "Manhole Seal", "Vat Outlet", "Walls in Silo"
        ];

        document.addEventListener("DOMContentLoaded", () => {
            createChecklistItems();
        });

        function createChecklistItems() {
            const checklistContainer = document.getElementById('checklist-items');
            checklistContainer.innerHTML = '';

            checklistItems.forEach(item => {
                const itemContainer = document.createElement('div');
                itemContainer.classList.add('checklist-item');

                const label = document.createElement('label');
                label.textContent = item;
                itemContainer.appendChild(label);

                const statusSelect = document.createElement('select');
                statusSelect.classList.add('form-select');
                statusSelect.innerHTML = `
                    <option value="ok">OK</option>
                    <option value="attention-required">Attention Required</option>
                    <option value="na">N/A</option>
                    <option value="not-checked">Not Checked</option>
                `;
                itemContainer.appendChild(statusSelect);

                const commentsInput = document.createElement('input');
                commentsInput.type = 'text';
                commentsInput.classList.add('form-control');
                commentsInput.placeholder = 'Comments';
                itemContainer.appendChild(commentsInput);

                const imageUpload = document.createElement('input');
                imageUpload.type = 'file';
                imageUpload.classList.add('form-control', 'image-upload');
                imageUpload.style.display = 'none';
                itemContainer.appendChild(imageUpload);

                statusSelect.addEventListener('change', () => {
                    if (statusSelect.value === 'attention-required') {
                        imageUpload.style.display = 'block';
                    } else {
                        imageUpload.style.display = 'none';
                    }

                    if (statusSelect.value === 'not-checked') {
                        commentsInput.value = "Milk in Vat";
                    } else {
                        if (commentsInput.value === "Milk in Vat") {
                            commentsInput.value = ""; // Clear the field if it was auto-filled by 'Not Checked'
                        }
                    }
                });

                checklistContainer.appendChild(itemContainer);
            });
        }

        async function generatePDF() {
            const form = document.getElementById('hygiene-checklist-form');
            let formData = new FormData(form);
            const dairyNumber = formData.get('dairy-number');

            let pdf = new jsPDF('p', 'pt', 'a4');

            // Add logo as Base64 string directly
            const logoImgBase64 = "data:image/jpeg;base64,[INSERT-YOUR-BASE64-STRING-HERE]";

            pdf.addImage(logoImgBase64, 'JPEG', 40, 20, 100, 50);
            
            pdf.setFontSize(22);
            pdf.setTextColor('#002B5C');
            pdf.text('Dairy Shed Hygiene Checklist', 40, 100);

            // Add farm details to the PDF
            pdf.setFontSize(12);
            pdf.setTextColor('#000000');
            pdf.text(`Dairy Number: ${dairyNumber}`, 40, 130);

            // Generate checklist items table
            const checklistItemsDiv = document.getElementById('checklist-items').children;
            const checklistTable = [];

            for (let item of checklistItemsDiv) {
                const itemName = item.querySelector('label').textContent;
                const status = item.querySelector('select').value;
                const comments = item.querySelector('input[type="text"]').value;

                checklistTable.push([itemName, status, comments]);
            }

            pdf.autoTable({
                startY: 150,
                head: [['Item', 'Status', 'Comments']],
                body: checklistTable,
                styles: {
                    fontSize: 10,
                    cellPadding: 5,
                },
                headStyles: {
                    fillColor: '#002B5C',
                    textColor: '#FFFFFF'
                }
            });

            pdf.save('Dairy_Shed_Hygiene_Checklist.pdf');
        }
    </script>
</body>
</html>
