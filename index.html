<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dairy Shed Hygiene Checklist</title>
    <style>
        body {
            background-color: #001F3F;
            color: #FFFFFF;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #002B5C;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            width: 100%;
        }
        h1, h2 {
            color: #FF851B;
            text-align: center;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        .section {
            border-bottom: 2px solid #FF851B;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        button {
            background-color: #FF851B;
            color: #FFFFFF;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background-color: #FF4136;
        }
        .image-upload {
            display: none;
        }
        .checklist-item {
            margin-bottom: 15px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Dairy Shed Hygiene Checklist</h1>
        
        <form id="hygiene-checklist-form">
            <div class="section">
                <h2>Farm Details</h2>
                <label for="dairy-company">Dairy Company:</label>
                <input type="text" id="dairy-company" name="dairy-company">

                <label for="dairy-number">Dairy Number:</label>
                <input type="text" id="dairy-number" name="dairy-number">

                <label for="address">Address:</label>
                <input type="text" id="address" name="address">

                <label for="customer-name">Customer Name:</label>
                <input type="text" id="customer-name" name="customer-name">

                <label for="region">Region:</label>
                <select id="region" name="region">
                    <option value="northland">Northland</option>
                    <option value="auckland">Auckland</option>
                    <option value="waikato">Waikato</option>
                    <option value="bay-of-plenty">Bay of Plenty</option>
                    <option value="gisborne">Gisborne</option>
                    <option value="hawkes-bay">Hawke's Bay</option>
                    <option value="taranaki">Taranaki</option>
                    <option value="manawatu-wanganui">Manawatu-Wanganui</option>
                    <option value="wellington">Wellington</option>
                    <option value="other">Other</option>
                </select>

                <label for="farm-name">Farm Name:</label>
                <input type="text" id="farm-name" name="farm-name">

                <label for="island">Island:</label>
                <select id="island" name="island">
                    <option value="north-island">North Island</option>
                    <option value="south-island">South Island</option>
                </select>

                <label for="visit-date">Visit Date:</label>
                <input type="date" id="visit-date" name="visit-date">

                <label for="visit-type">Visit Type:</label>
                <input type="text" id="visit-type" name="visit-type">

                <label for="inspection-start-time">Inspection Start Time:</label>
                <input type="time" id="inspection-start-time" name="inspection-start-time">

                <label for="inspection-end-time">Inspection End Time:</label>
                <input type="time" id="inspection-end-time" name="inspection-end-time">

                <label for="inspection-completed-by">Inspection Completed By:</label>
                <input type="text" id="inspection-completed-by" name="inspection-completed-by">

                <label for="call-type">Call Type:</label>
                <input type="text" id="call-type" name="call-type">
            </div>

            <div class="section">
                <h2>Checklist Items</h2>
                <div id="checklist-items">
                    <!-- Checklist items will be dynamically added here -->
                </div>
            </div>

            <button type="button" onclick="generatePDF()">Generate PDF</button>
        </form>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        const checklistItems = [
            "Pulsator Airline", "Long Bend Elbows", "Automatic Cup and Remover", "Diaphragm", "Receiving Can",
            "Sanitary Trap", "Main Milk Line", "Milk Line Seals in Good Condition", "Stainless Droppers", "Long Milk Rubber",
            "Liner", "Cluster", "Cluster Seal", "Cluster Button", "Non Return Valve at Milk Pump", "Milk Pump",
            "Filter Housing", "Plate Cooler", "Interceptor", "Receiver Airline", "Flushing Pulsator", "Air Purge Valve",
            "Vacuum Level", "Main Airline", "Plant Drainage - Milk Pump", "Plant Drainage - Filter/s", "Plant Drainage - Plate Cooler",
            "Plant Drainage - Vat Entry", "Plant Wash Tap", "Wash Jetters", "Centre Gland", "Test Bucket", "Inlet Valve",
            "Non-Return Valve", "Spray Ball", "Agitator", "Silo Door", "Manhole Seal", "Vat Outlet", "Walls in Silo"
        ];

        window.onload = () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('visit-date').value = today;

            const checklistContainer = document.getElementById('checklist-items');
            checklistItems.forEach(item => {
                const itemContainer = document.createElement('div');
                itemContainer.classList.add('checklist-item');

                const label = document.createElement('label');
                label.textContent = item;
                itemContainer.appendChild(label);

                const statusSelect = document.createElement('select');
                statusSelect.innerHTML = `
                    <option value="ok">OK</option>
                    <option value="attention-required">Attention Required</option>
                    <option value="na">N/A</option>
                `;
                itemContainer.appendChild(statusSelect);

                const commentsInput = document.createElement('input');
                commentsInput.type = 'text';
                commentsInput.placeholder = 'Comments';
                itemContainer.appendChild(commentsInput);

                const imageUpload = document.createElement('input');
                imageUpload.type = 'file';
                imageUpload.classList.add('image-upload');
                itemContainer.appendChild(imageUpload);

                statusSelect.addEventListener('change', () => {
                    if (statusSelect.value === 'attention-required') {
                        imageUpload.style.display = 'block';
                    } else {
                        imageUpload.style.display = 'none';
                    }
                });

                checklistContainer.appendChild(itemContainer);
            });
        };

        function generatePDF() {
            const form = document.getElementById('hygiene-checklist-form');
            let formData = new FormData(form);
            let pdf = new jsPDF();
            let y = 10;

            pdf.setFontSize(16);
            pdf.text("Dairy Shed Hygiene Checklist", 105, y, { align: "center" });
            y += 10;

            pdf.setFontSize(12);
            pdf.text("Farm Details:", 10, y);
            y += 10;
            pdf.text(`Dairy Company: ${formData.get('dairy-company')}`, 10, y);
            y += 10;
            pdf.text(`Dairy Number: ${formData.get('dairy-number')}`, 10, y);
            y += 10;
            pdf.text(`Address: ${formData.get('address')}`, 10, y);
            y += 10;
            pdf.text(`Customer Name: ${formData.get('customer-name')}`, 10, y);
            y += 10;
            pdf.text(`Region: ${formData.get('region')}`, 10, y);
            y += 10;
            pdf.text(`Farm Name: ${formData.get('farm-name')}`, 10, y);
            y += 10;
            pdf.text(`Island: ${formData.get('island')}`, 10, y);
            y += 10;
            pdf.text(`Visit Date: ${formData.get('visit-date')}`, 10, y);
            y += 10;
            pdf.text(`Visit Type: ${formData.get('visit-type')}`, 10, y);
            y += 10;
            pdf.text(`Inspection Start Time: ${formData.get('inspection-start-time')}`, 10, y);
            y += 10;
            pdf.text(`Inspection End Time: ${formData.get('inspection-end-time')}`, 10, y);
            y += 10;
            pdf.text(`Inspection Completed By: ${formData.get('inspection-completed-by')}`, 10, y);
            y += 10;
            pdf.text(`Call Type: ${formData.get('call-type')}`, 10, y);
            y += 20;

            pdf.text("Checklist Items:", 10, y);
            y += 10;
            const checklistItemsDiv = document.getElementById('checklist-items').children;
            let allOk = true;
            for (let item of checklistItemsDiv) {
                const itemName = item.querySelector('label').textContent;
                const status = item.querySelector('select').value;
                const comments = item.querySelector('input[type="text"]').value;
                const imageUpload = item.querySelector('input[type="file"]');

                pdf.text(`${itemName}: ${status}`, 10, y);
                y += 10;
                if (comments) {
                    pdf.text(`Comments: ${comments}`, 10, y);
                    y += 10;
                }
                if (status === 'attention-required' && imageUpload.files.length > 0) {
                    allOk = false;
                    const file = imageUpload.files[0];
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const img = new Image();
                        img.src = event.target.result;
                        img.onload = function () {
                            pdf.addImage(img, 'JPEG', 10, y, 50, 50);
                            y += 60;
                            if (y > 270) {
                                pdf.addPage();
                                y = 10;
                            }
                            savePDF(pdf);
                        };
                    };
                    reader.readAsDataURL(file);
                } else {
                    y += 10;
                }
                if (y > 270) {
                    pdf.addPage();
                    y = 10;
                }
            }

            if (allOk) {
                pdf.text(`Shed Inspection completed on ${formData.get('visit-date')} with no issues found.`, 10, y);
            } else {
                y += 10;
                pdf.text("Summary of Issues:", 10, y);
                y += 10;
                for (let item of checklistItemsDiv) {
                    const itemName = item.querySelector('label').textContent;
                    const status = item.querySelector('select').value;
                    if (status === 'attention-required') {
                        const comments = item.querySelector('input[type="text"]').value;
                        pdf.text(`${itemName}: Attention Required`, 10, y);
                        y += 10;
                        if (comments) {
                            pdf.text(`Comments: ${comments}`, 10, y);
                            y += 10;
                        }
                    }
                    if (y > 270) {
                        pdf.addPage();
                        y = 10;
                    }
                }
            }

            savePDF(pdf);
        }

        function savePDF(pdf) {
            pdf.save('Dairy_Shed_Hygiene_Checklist.pdf');
        }
    </script>
</body>
</html>
